CREATE TABLE IF NOT EXISTS users
(
user_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
email CHARACTER VARYING(255) NOT NULL,
login CHARACTER VARYING(50) NOT NULL,
name CHARACTER VARYING(50),
birthday DATE NOT NULL 
);

CREATE TABLE IF NOT EXISTS friendship
(
user_id INTEGER NOT NULL REFERENCES users (user_id) ON DELETE CASCADE,
friend_id INTEGER NOT NULL REFERENCES users (user_id) ON DELETE CASCADE,
status BOOLEAN NOT NULL,
PRIMARY KEY(user_id, friend_id)
);

CREATE TABLE IF NOT EXISTS mpa
(
mpa_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name CHARACTER VARYING(50) NOT NULL UNIQUE,
description CHARACTER VARYING(255) NOT NULL
);

CREATE TABLE IF NOT EXISTS films
(
film_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name CHARACTER VARYING(255) NOT NULL,
description CHARACTER VARYING(200) NOT NULL,
release_date DATE NOT NULL,
duration INTEGER NOT NULL,
mpa_id INTEGER NOT NULL REFERENCES mpa (mpa_id)
);

CREATE TABLE IF NOT EXISTS likes
(
film_id INTEGER NOT NULL REFERENCES films (film_id) ON DELETE CASCADE,
user_id INTEGER NOT NULL REFERENCES users (user_id) ON DELETE CASCADE,
PRIMARY KEY(film_id, user_id)
);

CREATE TABLE IF NOT EXISTS genres
(
genre_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name CHARACTER VARYING(255) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS film_genre
(
film_id INTEGER NOT NULL REFERENCES films (film_id) ON DELETE CASCADE,
genre_id INTEGER NOT NULL REFERENCES genres (genre_id) ON DELETE CASCADE,
PRIMARY KEY (film_id, genre_id)
);

DELETE FROM USERS WHERE USER_ID BETWEEN 1 AND 3;

ALTER TABLE USERS  ALTER COLUMN user_id RESTART WITH 1;